[section ram, code]
	init CodeEnd
	jump main
vtable_ExampleClass:
    dq 3
    dd ExampleClass_DoThing
    dd 1
    dd Example_DoOtherThing
    dd 2
    dd ExampleClass_ShowMessage
    dd 3
vtable_Example:
    dq 2
    dd Example_DoThing
    dd 4
    dd Example_DoOtherThing
    dd 5
ExampleClass_ShowMessage:
	push 1
	push 2
	pop_sf
	pop_sf
	call printf
	ret
ExampleClass_DoThing:
	push 2
	push 2
	pop_sf
	pop_sf
	call printf
	ret
Example_DoThing:
	push 3
	push 2
	pop_sf
	pop_sf
	call printf
	ret
Example_DoOtherThing:
	push 4
	push 2
	pop_sf
	pop_sf
	call printf
	ret
helper:
	sub_s 1
	wide_store
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	push_hf
	pop_vtable vtable_Example
	pop_hf
	pop_hf
	pop_hf
	pop_hf
	add_s 1
	wide_store
	push_hf
	pop_vtable vtable_ExampleClass
	pop_hf
	pop_hf
	add_s 2
	wide_store
	push 0
	push 2
	add_s 3
	wide_store
	push 5
	push 2
	add_s 1
	load
	add_mem_imm 1
	wide_store
	add_s 2
	load
	load
	add_mem_imm 3
	load
	pop
	call_from_stack
	wide_store
	add_s 1
	load
	add_mem_imm 1
	load
	add_s 3
	wide_store
	add_s 1
	load
	load
	sub_s 1
	load
	check_vtable
	jz label_9
	jump label_10
	ret
label_9:
	call error
	jump label_11
label_10:
	call_from_stack
	jump label_11
label_11:
	add_s 3
	load
	ret
fib:
	sub_s 1
	wide_store
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	push_hf
	pop_vtable vtable_Example
	pop_hf
	pop_hf
	pop_hf
	pop_hf
	add_s 1
	wide_store
	push_hf
	pop_vtable vtable_ExampleClass
	pop_hf
	pop_hf
	add_s 2
	wide_store
	push 0
	push 2
	add_s 3
	wide_store
	push 5
	push 2
	add_s 1
	load
	add_mem_imm 1
	wide_store
	add_s 1
	load
	add_mem_imm 1
	load
	add_s 3
	wide_store
	add_s 1
	load
	load
	sub_s 1
	load
	check_vtable
	jz label_13
	jump label_14
	ret
label_13:
	call error
	jump label_15
label_14:
	call_from_stack
	jump label_15
label_15:
	add_s 3
	load
	ret
M:
	sub_s 1
	wide_store
	sub_s 2
	wide_store
	push 7
	push 2
	pop_sf
	pop_sf
	call printf
	ret
error:
	push 9
	push 2
	pop_sf
	pop_sf
	call printf
	ret
printf:
	sub_s 1
	wide_store
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	pop_sf
	push 0
	push 2
	add_s 1
	wide_store
	push 0
	push 2
	add_s 2
	wide_store
	push 0
	push 2
	add_s 3
	wide_store
	push 10
	push 2
	add_s 1
	wide_store
	push 0
	push 2
	add_s 2
	wide_store
		;while
label_22:
	push 0
	push 2
	sub_s 1
	load
	wide_sub
	pop
	jz label_24
	push 1
		;false branch
	jump label_25
label_24:
	push 0
		;true branch
label_25:
	jz label_26
		;while body
	push 10
	push 2
	add_s 2
	load
	wide_mult
	add_s 2
	wide_store
	push 10
	push 2
	sub_s 1
	load
	wide_mod
	add_s 3
	wide_store
	add_s 3
	load
	add_s 2
	load
	wide_add
	add_s 2
	wide_store
	push 10
	push 2
	sub_s 1
	load
	wide_div
	sub_s 1
	wide_store
	jump label_22
label_26:
		;end while
		;while
label_30:
	push 0
	push 2
	add_s 2
	load
	wide_sub
	pop
	jz label_32
	push 1
		;false branch
	jump label_33
label_32:
	push 0
		;true branch
label_33:
	jz label_34
		;while body
	push 10
	push 2
	add_s 2
	load
	wide_mod
	add_s 3
	wide_store
	push 48
	push 2
	add_s 3
	load
	wide_add
	add_s 3
	wide_store
	add_s 3
	load
	pop
	write
	push 10
	push 2
	add_s 2
	load
	wide_div
	add_s 2
	wide_store
	jump label_30
label_34:
		;end while
	push 10
	push 2
	pop
	write
	ret
main:
	pop_sf
	pop_sf
	push 0
	push 2
	add_s 1
	wide_store
	push 0
	push 2
	add_s 1
	wide_store
		;while
label_40:
	push 5
	push 2
	add_s 1
	load
	wide_sub
	pop
	jlt label_42
	push 0
		;false branch
	jump label_43
label_42:
	push 1
		;true branch
label_43:
	jz label_44
		;while body
	push 5
	push 2
	pop_sf
	pop_sf
	call helper
	pop_sf
	pop_sf
	call printf
	push 1
	push 2
	add_s 1
	load
	wide_add
	add_s 1
	wide_store
	jump label_40
label_44:
		;end while
	jump halt
halt:
	hlt
CodeEnd:
